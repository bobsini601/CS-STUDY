## 📌 로드 밸런싱이란?

---

<aside>
💡 하나의 인터넷 서비스가 발생하는 트래픽이 많을 때 여러 대의 서버가 분산처리하여 서버의 로드율 증가, 부하량, 속도저하 등을 고려하여 적절히 분산처리하여 해결해주는 서비스

</aside>

![클라이언트와 서버풀(Server Pool, 분산 네트워크를 구성하는 서버들의 그룹) 사이에 위치](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/e4a5159e-264e-467b-8f49-0b3014004079/Untitled.png)

클라이언트와 서버풀(Server Pool, 분산 네트워크를 구성하는 서버들의 그룹) 사이에 위치

서비스의 규모가 커지고, 이용자 수가 늘어나게 되면 기존의 서버만으로는 원활한 서비스 동작이 불가능하게 되고, 이에 대처할 수 있는 방법은 크게 두 가지로 나뉜다.

- `**Scale-up` : Server가 더 빠르게 동작하기 위해 하드웨어 성능을 올리는 방법. (서버 자체의 성능을 확장)**
- `**Scale-out` : 하나의 Server 보다는 여러 대의 Server가 나눠서 일을 하는 방법.**

 

여러 대의 서버로 트래픽을 균등하게 분산해주는 로드 밸런싱은 그 중에서 `Scale-out` 방식이다.

## 📌 로드밸런싱 알고리즘

---

### ▫ 라운드 로빈 방식 (Round Robin Method)

- 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식
- 클라이언트의 요청을 순서대로 분재하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고 서버와의 연결(세션)이 오래 지속되지 않는 경우에 활용하기 적합합니다.

### ▫ 가중 라운드로빈 방식 (Weighted Round Robin Method)

- 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분하는 방식
- 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식입니다.
- 예를 들어서 A라는 서버가 5라는 가중치를 갖고 B라는 서버가 2라는 가중치를 갖는다면, 로드 밸런서는 라운드 로빈 방식으로 A 서버에 5개 B 서버에 2개의 요청을 전달합니다.

### ▫ IP 해시 방식 (IP Hash Method)

- 클라이언트의 IP 주소를 특정 서버로 매핑하여 요청을 처리하는 방식
- 사용자의 IP를 해싱해 로드를 분배하기 때문에 사용자가 항상 동일한 서버로 연결되는 것을 보장
- 경로가 보장되며, 접속자 수가 많을수록 분산 및 효율이 뛰어남

### ▫ 최소 연결 방식 ( Least Connection Method) `多`

- 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트래픽을 배분
- 자주 세션이 길어지거나, 서버에 분배된 트래픽들이 일정하지 않은 경우에 적합한 방식

### ▫ 최소 리스폰 타임 (Least Response Time Method)

- 서버의 현재 연결 상태와 응답시간을 모두 고려하여 트래픽을 배분하는 방식
- 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분하는 방식
- **경로가 보장되며, 접속자 수가 많을수록 분산 및 효율이 뛰어남.**

### ▫ 대역폭 방식 (Bandwidth Method)

- 서버들과의 **대역폭을 고려**하여 서버에 트래픽을 할당.

## 📌 로드 밸런싱의 기능

---

### ▫ **Health Check (상태 확인)**

서버들에 대한 주기적인 Health Check를 통해 **서버들의 장애 여부를 판단**하여, **정상 동작 중인 서버로만 트래픽을 보낸다.**

- **L3** 체크 : **ICMP**를 이용하여 서버의 **IP 주소가 통신 가능한 상태인지를 확인**한다.
- **L4** 체크 : TCP는 3 Way-Handshaking (전송 - 확인/전송 - 확인) 를 기반으로 통신하는데, 이러한 **TCP**의 특성을 바탕으로 **각 포트 상태를 체크**하는 방식.
- **L7** 체크 : **어플리케이션 계층에서 체크**를 수행. **실제 웹페이지에 통신을 시도**하여 이상 유무를 파악.

### ▫ **Tunneling (터널링)**

- **데이터 스트림을 인터넷 상에서 가상의 파이프를 통해 전달시키는 기술**
- 패킷 내에 터널링할 대상을 캡슐화시켜 목적지까지 전송.
- **연결된 상호 간에만 캡슐화된 패킷을 구별**해 캡슐화를 해제하게 함.
    
    (데이터를 캡슐화해서 연결된 상호 간에만 캡슐화된 패킷을 구별해 캡슐화를 해제)
    

### ▫ **NAT (Network Address Translation)**

내부 네트워크에서 사용하는 **사설 IP 주소**와 로드밸런서 외부의 **공인 IP 주소 간의 변환 역할.**

로드밸런싱 관점에서는 여러 개의 호스트가 **하나의 공인 IP 주소(VLAN or VIP)를 통해 접속하는 것이 주 목적.**

- **SNAT (Source Network Address Translation)** : 내부에서 외부로 트래픽이 나가는 경우.**내부 사설 IP 주소 -> 외부 공인 IP 주소**로 변환.
- **DNAT (Destination Network Address Translation)** : 외부에서 내부로 트래픽이 들어오는 경우.**외부 공인 IP 주소 -> 내부 사설 IP 주소**로 변환.

### ▫ **DSR (Dynamic Source Routing protocol)**

서버에서 클라이언트로 트래픽이 되돌아가는 경우, 목적지를 클라이언트로 설정한 다음, **네트워크 장비나 로드밸런서를 거치지 않고 바로 클라이언트를 찾아가는 방식.** 이 기능을 통해 **로드밸런서의 부하를 줄여**줄 수 있음.

***ICMP** : Internet Control Message Protocol. 패킷 전송에 실패했을 때 에러가 났음을 **알림**과 동시에, 해결 가능한 힌**트를 제공**하는 메시징 프로토콜. 에서 동작.

## 📌 로드 밸런싱의 종류

---

### ▫ **L2**

- `Mac주소`를 바탕으로 Load Balancing
- 장점
    
    구조가 간단, 신뢰성이 높음, 가격저렴, 성능이 좋음
    
- 단점
    
    Broadcast 패킷에 의해 성능저하 발생, 라우팅 등 상위레이어 프로토콜 기반 스위칭 불가
    

### ▫ **L3**

- `IP주소`를 바탕으로 Load Balancing
- 장점
    
    Broadcast 트래픽으로 전체 성능 저하 방지, 트레픽 체크
    
- 단점
    
    특정 프로토콜을 이용해야 스위칭 가능
    

<aside>
💡 부하 분산에는 `**L4 로드밸런서**`와 `**L7 로드밸런서**`가 가장 많이 활용됩니다. 
그 이유는 L4 로드밸런서부터 **포트(Port) 정보를 바탕으로 로드를 분산**하는 것이 가능하기 때문
한 대의 서버에 각기 다른 포트번호를 부여하여 다수의 서버 프로그램을 운영하는 경우라면 최소 L4 로드밸런서 이상을 사용해야만 합니다.

</aside>

### ▫ **L4**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/94d9c1e0-93c0-4b0f-92bc-468f5ada0bf4/Untitled.png)

- Transport Layer(IP와 Port) Level에서 Load Balancing을 합니다.
- TCP, UDP 프로토콜
- 주로 Round Robin 방식 사용
- **IP 주소**, **포트번호**, **MAC**주소, **전송 프로토콜** 등에 따라 트래픽을 분산하는 것이 가능.
- 장점
    - Port기반 스위칭 지원, VIP를 이용하여 여러대를 한대로 묶어 부하분산
    - 패킷의 내용을 확인하지 않고 로드를 분산하므로 **속도가 빠르고 효율이 높음.**
    - 데이터의 내용을 **복호화할 필요가 없기에** 안전.
    - L7 로드밸런서보다 **가격이 저렴.**

- 단점
    - 패킷의 내용을 살펴볼 수 없으므로, **섬세한 라우팅 불가.**
    - **사용자의 IP가 수시로 바뀌는 경우**라면, 연속적인 서비스를 제공하기 어려움.

### ▫ **L7**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/7fc79c12-3056-4cbd-b4e2-25f3ae2b4970/Untitled.png)

- Application Layer(사용자의 Request) Level에서 Load Balancing
- HTTP, HTTPS, FTP 프로토콜
- **어플리케이션 계층(HTTP, FTP, SMTP 등)에서 로드를 분산**하기 때문에, **HTTP 헤더**, **쿠키**
등과 같은 사용자 요청을 기준으로 특정 서버에 트래픽을 분산하는 것이 가능.
- L4 로드밸런서의 기능에 더하여, **패킷의 내용을 확인하고 그 내용에 따라 로드를 특정 서버에 분배**하는 것이 가능.
- **특정한 패턴을 지닌 바이러스를 감지**해 네트워크 보호 가능.
- Dos/DDos와 같은**비정상적인 트래픽 필터링** 가능.
- 방식
    - **URL 스위칭(URL Switching)**
        
        방식 : **특정 하위 URL들**은 특정 서버로 처리하는 방식.
        
        ex) '.../steven/image' => 이미지 처리 서버   /    '.../steven/video' => 동영상 처리 서버
        
    - **컨텍스트 스위칭(Context Switching)**
        
        방식 : 클라이언트가 요청한 **특정 리소스에 대해 특정 서버로** 연결 가능.
        
        ex) 이미지 파일에 대해서는**확장자를 참조**하여, 별도로 구성된 이미지 파일이 있는 서버 or 스토리지로 직접 연결.
        
    - **쿠키 지속성(Persistence with Cookies)**
        
        쿠키 정보를 바탕으로 **클라이언트가 연결했었던 동일한 서버에 계속 할당**해 주는 방식. 특히, 사설 네트워크에 있던 클라이언트의 IP 주소가 공인 IP 주소로 치환되어 전송하는 방식을 지원.
        
        ex) **X-Forwarded-For 헤더**에 클라이언트 IP 주소를 별도로 기입
        
    
- 장점
    - 상위 계층에서 로드를 분산하기 때문에 **훨씬 더 섬세한 라우팅** 가능.
    - **캐싱(Cashing) 기능**을 제공.
    - 비정상적인 트래픽을 사전에 필터링할 수 있어 **서비스 안정성 높음.**

- 단점
    - L4 로드밸런서에 비해 **비쌈.**
    - **패킷의 내용을 `복호화`하여야**하므로 더 높은 비용을 지불해야 함.
    - 클라이언트가 로드밸런서와 인증서를 공유해야 하기 때문에, 공격자가 로드밸런서를 통해 클라이언트의 데이터에 접근할 수 있는 **보안상의 위험성** 존재.

---

---

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/9721b3ba-93e7-41b5-aa9d-92d659caf9a5/Untitled.png)

## 📌 로드 밸런서 장애 대비

<aside>
💡 서버를 분배하는 로드 밸런서에 문제가 생길 수 있기 때문에 **로드 밸런서를 이중화**하여 대비한다.(Active와 Passive 상태)

</aside>

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/6fcd7c38-c28f-4769-a392-8703c3739514/Untitled.png)

- 이중화된 Load Balancer들은 서로 Health Check를 합니다.
- Main Load Balancer가 동작하지 않으면 가상IP(VIP, Virtual IP)는 여분의 Load Balancer로 변경됩니다.
- 여분의 Load Balancer로 운영하게 됩니다.

## 📌 **로드 밸런싱의 이점**

로드 밸런싱은 애플리케이션 서버와 방문자 또는 클라이언트 간의 인터넷 트래픽을 지시하고 제어합니다. 결과적으로 애플리케이션의 가용성, 확장성, 보안 및 성능이 향상됩니다.

### ▫ 애플리케이션 가용성

서버 장애 또는 유지 관리로 인해 애플리케이션 가동 중지 시간이 늘어 방문자가 애플리케이션을 사용할 수 없게 될 수 있습니다. 로드 밸런서는 서버 문제를 자동으로 감지하고 클라이언트 트래픽을 사용 가능한 서버로 리디렉션하여 시스템의 내결함성을 높입니다. 로드 밸런싱을 사용하여 다음 태스크를 더 쉽게 수행할 수 있습니다.

- 애플리케이션 가동 중지 없이 애플리케이션 서버 유지 관리 또는 업그레이드 실행
- 백업 사이트에 자동 재해 복구 제공
- 상태 확인을 수행하고 가동 중지를 유발할 수 있는 문제 방지

### ▫ 애플리케이션 확장성

로드 밸런서를 사용하여 여러 서버 간에 네트워크 트래픽을 지능적으로 전달할 수 있습니다. 로드 밸런싱이 다음을 수행하므로 애플리케이션에서 수천 개의 클라이언트 요청을 처리할 수 있습니다.

- 한 서버에서 트래픽 병목 현상 방지
- 필요한 경우 다른 서버를 추가하거나 제거할 수 있도록 애플리케이션 트래픽을 예측합니다.
- 안심하고 조정할 수 있도록 시스템에 중복성을 추가합니다.

### ▫ 애플리케이션 보안

로드 밸런서에는 인터넷 애플리케이션에 또 다른 보안 계층을 추가할 수 있는 보안 기능이 내장되어 있습니다. 이는 공격자가 서버 장애를 일으키는 수백만 개의 동시 요청으로 애플리케이션 서버를 가득 채우는 분산 서비스 거부 공격을 처리하는 데 유용한 도구입니다. 로드 밸런서는 다음을 수행할 수도 있습니다.

- 트래픽 모니터링 및 악성 콘텐츠 차단
- 공격 트래픽을 여러 백엔드 서버로 자동으로 리디렉션하여 영향 최소화
- 추가 보안을 위해 네트워크 방화벽 그룹을 통해 트래픽 라우팅

### ▫ 애플리케이션 성능

로드 밸런서는 응답 시간을 늘리고 네트워크 지연 시간을 줄여 애플리케이션 성능을 향상시킵니다. 다음과 같은 몇 가지 중요한 태스크를 수행합니다.

- 서버 간에 로드를 균등하게 배포하여 애플리케이션 성능 향상
- 클라이언트 요청을 지리적으로 더 가까운 서버로 리디렉션하여 지연 시간 단축
- 물리적 및 가상 컴퓨팅 리소스의 신뢰성 및 성능 보장

# 👀 CS 질문 list

---

### **Q1.  로드 밸런싱(Load Balancing) 에 대해 말해보세요.**

---

A.  로드 밸런싱은 주로 서버 구축 및 활용 시에 고려하는데요. 간단하게 말씀드리면 **서버에 가해지는 부하를 적절하게 분산시켜주는 장치 또는 기술**을 뜻합니다. 처음에 구축했던 서버가 수용할 수 있는 범위보다 더 큰 트래픽으로 기존 서버를 사용할 수 없게 되는 경우가 있습니다. 이 때 서버 트래픽을 분산시키기 위해 사용합니다.

![https://blog.kakaocdn.net/dn/cMMRKW/btqNzpyOAvR/6OhhnhZKDGIyuDrk03LbpK/img.png](https://blog.kakaocdn.net/dn/cMMRKW/btqNzpyOAvR/6OhhnhZKDGIyuDrk03LbpK/img.png)

로드 밸런싱 (출처 : https://msandbu.org/deep-dive-azure-load-balancer)

### **Q2.  서버 확장의 두 가지 방법(Scale-Up, Scale-Out) 에 대해 설명해보세요.**

---

A.  **Scale-Up 방식은 서버 자체의 성능을 향상시키는 것**으로, 서버 CPU, RAM 등을 교체하여 서버의 성능을 향상시킵니다.

반면, **Scale-Out 방식은 기존 서버와 동일하거나 낮은 서버를 여러 대 증설하여 운영하는 것**을 뜻합니다. 보통 Scale-Out 방식을 사용하는데, 그 이유는 서버 성능을 향상시키는 것보다 여러 대의 서버를 증설하는 것이 비용적 측면에서 효과적이기 때문입니다.

### **Q3.  로드 밸런싱 알고리즘 중 대표적인 라운드 로빈, 최소 연결 방식 에 대해 설명해보세요.**

---

A.  라운드 로빈(Round Robin) 알고리즘은 **서버에 들어오는 요청들을 순서대로 돌아가면서 배정하는 알고리즘**입니다. 뭐가되었든 하나씩 배정하기 때문에 여러 대의 서버 성능이 비슷하고 세션이 오래 지속되지 않는 경우에 적합합니다.

반면, 최소 연결 방식(Least Connection Method) 은 요청이 서버에 들어왔을 때 **가장 연결이 적은 서버에 배정하는 알고리즘**입니다. 서버 트래픽이 일정하지 않고 세션이 길어질 때 적합합니다.

이 외에도 서버마다 가중치를 매겨 가중치에 맞게 요청을 배정하는 **가중 라운드 로빈** **방식**, 클라이언트의 IP주소를 해싱하여 분배하는 **IP 해싱 방식**, 서버의 현재 연결 상태와 응답 시간을 고려하여 배분하는 **최소 리스폰 타임** 알고리즘이 있습니다.

### **Q4.  L4 로드 밸런싱과 L7 로드 밸런싱에 대해 설명하고, 차이를 말해보세요.**

---

A.  L4 로드 밸런싱은 **Layer 4**(네트워크 계층 또는 트랜스포트(전송) 계층) 의 정보를 바탕으로 트래픽을 분산하는 방식입니다. 즉, TCP, UDP, IP 정보들을 바탕으로 분산하는데요. 이는 정보가 어떻게 생겼는지 보지 않고 **패킷 레벨에서만 트래픽을 분산**하기 때문에 속도가 빠르고 효율성이 높습니다. 그리고 L7 로드 밸런싱보다 저렴합니다.

반면, L7 로드 밸런싱은 **Layer 7**(애플리케이션(응용) 계층) 의 정보를 바탕으로 요청을 분산합니다. **HTTP Header, Cookie 등과 같이 사용자가 요청한 정보들을 바탕으로 트래픽을 분산**하기 때문에 섬세한 라우팅이 가능하고 비정상적인 트래픽을 판별할 수 있습니다. 하지만, L4 로드 밸런싱보다 비용이 높습니다.

> ref
> 

[[Network] 2020.11.16. 오늘의 면접 Q&A](https://maivve.tistory.com/269)

> ref
> 

---

[[CS] Load Balancer(로드밸런서)](https://azderica.github.io/00-load-balancer/)

[로드밸런서(Load Balancer)의 개념과 특징](https://m.post.naver.com/viewer/postView.nhn?volumeNo=27046347&memberNo=2521903)

[[AWS] 로드밸런싱 알아보기](https://medium.com/harrythegreat/aws-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0-9fd0955f859e)

[로드 밸런서(Load Balancer)란?](https://nesoy.github.io/articles/2018-06/Load-Balancer)

[로드 밸런싱에 대해 알아보자!](https://tecoble.techcourse.co.kr/post/2021-11-07-load-balancing/)

[[네트워크] 로드밸런싱의 개념 및 기법 설명](https://co-no.tistory.com/22)

[로드 밸런싱이란 무엇인가요? 로드 밸런싱 설명 - AWS](https://aws.amazon.com/ko/what-is/load-balancing/)